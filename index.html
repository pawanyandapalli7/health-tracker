<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Health Tracker â€” Pawan</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #080a0f;
  --surface: #0f1218;
  --card: #131720;
  --border: #1e2330;
  --border2: #252d3d;
  --accent: #f5c842;
  --accent2: #5b8dee;
  --accent3: #e8856a;
  --green: #4caf7d;
  --purple: #9b6bda;
  --text: #dde1ea;
  --muted: #5a6278;
  --muted2: #7a8499;
  --mono: 'DM Mono', monospace;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'DM Sans', sans-serif;
  min-height: 100vh;
}

/* â”€â”€ NAV â”€â”€ */
nav {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem 1.5rem;
  border-bottom: 1px solid var(--border);
  background: rgba(8,10,15,0.95);
  backdrop-filter: blur(12px);
  position: sticky;
  top: 0;
  z-index: 100;
  flex-wrap: wrap;
  gap: 0.75rem;
}

.nav-logo { font-family: var(--mono); font-size: 0.82rem; color: var(--accent); letter-spacing: 2px; }

.nav-tabs {
  display: flex;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  overflow: hidden;
}

.nav-tab {
  padding: 0.45rem 1.1rem;
  font-size: 0.78rem;
  font-weight: 500;
  cursor: pointer;
  color: var(--muted2);
  transition: all 0.2s;
  border: none;
  background: transparent;
  font-family: 'DM Sans', sans-serif;
}

.nav-tab.active { background: var(--accent); color: #000; font-weight: 600; }
.nav-tab:hover:not(.active) { color: var(--text); background: var(--border); }

.nav-right {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.sync-status {
  font-family: var(--mono);
  font-size: 0.7rem;
  display: flex;
  align-items: center;
  gap: 0.35rem;
}

.sync-dot {
  width: 6px; height: 6px;
  border-radius: 50%;
  background: var(--muted);
  transition: background 0.3s;
}

.sync-dot.syncing { background: var(--accent); animation: pulse 1s infinite; }
.sync-dot.synced { background: var(--green); }
.sync-dot.error { background: var(--accent3); }

@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }

.settings-btn {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--muted2);
  font-family: var(--mono);
  font-size: 0.7rem;
  padding: 0.35rem 0.75rem;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s;
}
.settings-btn:hover { border-color: var(--accent2); color: var(--accent2); }

/* â”€â”€ VIEWS â”€â”€ */
.view { display: none; padding: 1.5rem; max-width: 1000px; margin: 0 auto; }
.view.active { display: block; }

/* date picker */
.date-picker-wrap {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 0.35rem 0.75rem;
}

.date-nav-btn {
  background: none;
  border: none;
  color: var(--muted2);
  cursor: pointer;
  font-size: 1rem;
  padding: 0 0.1rem;
  line-height: 1;
  transition: color 0.15s;
}
.date-nav-btn:hover { color: var(--accent); }
.date-nav-btn:disabled { opacity: 0.25; cursor: default; }

#date-picker {
  background: transparent;
  border: none;
  color: var(--accent);
  font-family: var(--mono);
  font-size: 0.78rem;
  outline: none;
  cursor: pointer;
  text-align: center;
  min-width: 100px;
}

#date-picker::-webkit-calendar-picker-indicator {
  filter: invert(0.5) sepia(1) saturate(3) hue-rotate(5deg);
  cursor: pointer;
}

.today-tag {
  font-family: var(--mono);
  font-size: 0.65rem;
  color: var(--bg);
  background: var(--accent);
  border-radius: 4px;
  padding: 1px 5px;
  font-weight: 600;
}

/* â”€â”€ LOGIN SCREEN â”€â”€ */
#login-screen {
  position: fixed;
  inset: 0;
  background: var(--bg);
  z-index: 500;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1rem;
}
#login-screen.hidden { display: none; }

.login-box {
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 20px;
  padding: 2.5rem 2rem;
  max-width: 400px;
  width: 100%;
  text-align: center;
}

.login-logo {
  font-family: var(--mono);
  font-size: 0.72rem;
  color: var(--accent);
  letter-spacing: 3px;
  text-transform: uppercase;
  margin-bottom: 1.5rem;
}

.login-box h1 { font-family: 'Playfair Display', serif; font-size: 1.7rem; margin-bottom: 0.4rem; }
.login-box h1 span { color: var(--accent); }
.login-subtitle { font-size: 0.8rem; color: var(--muted2); margin-bottom: 2rem; }
.login-fields { text-align: left; }

.login-error {
  font-family: var(--mono);
  font-size: 0.75rem;
  color: var(--accent3);
  text-align: center;
  margin-top: 0.75rem;
  display: none;
}
.login-error.visible { display: block; }

.login-btn {
  width: 100%;
  background: var(--accent);
  color: #000;
  border: none;
  border-radius: 10px;
  padding: 0.85rem;
  font-weight: 700;
  font-size: 0.9rem;
  cursor: pointer;
  margin-top: 1.5rem;
  font-family: 'DM Sans', sans-serif;
  letter-spacing: 0.5px;
  transition: opacity 0.2s, transform 0.1s;
}
.login-btn:hover { opacity: 0.88; }
.login-btn:active { transform: scale(0.98); }
.login-btn.shake { animation: loginShake 0.4s ease; }

@keyframes loginShake {
  0%,100% { transform: translateX(0); }
  20% { transform: translateX(-8px); }
  40% { transform: translateX(8px); }
  60% { transform: translateX(-5px); }
  80% { transform: translateX(5px); }
}

.logout-btn {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--muted2);
  font-family: var(--mono);
  font-size: 0.7rem;
  padding: 0.35rem 0.75rem;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s;
}
.logout-btn:hover { border-color: var(--accent3); color: var(--accent3); }

/* â”€â”€ SETUP MODAL â”€â”€ */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(8,10,15,0.92);
  backdrop-filter: blur(8px);
  z-index: 200;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1rem;
}

.modal-overlay.hidden { display: none; }

.modal {
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 16px;
  padding: 2rem;
  max-width: 520px;
  width: 100%;
}

.modal h2 {
  font-family: 'Playfair Display', serif;
  font-size: 1.4rem;
  margin-bottom: 0.4rem;
}

.modal p {
  font-size: 0.83rem;
  color: var(--muted2);
  margin-bottom: 1.5rem;
  line-height: 1.6;
}

.field { margin-bottom: 1rem; }
.field label { display: block; font-family: var(--mono); font-size: 0.7rem; color: var(--muted); letter-spacing: 1.5px; text-transform: uppercase; margin-bottom: 0.4rem; }

.field input {
  width: 100%;
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: 8px;
  color: var(--text);
  font-family: var(--mono);
  font-size: 0.82rem;
  padding: 0.65rem 1rem;
  outline: none;
  transition: border-color 0.2s;
}

.field input:focus { border-color: var(--accent); }
.field input::placeholder { color: var(--muted); }

.field-hint { font-size: 0.72rem; color: var(--muted); margin-top: 0.3rem; line-height: 1.5; }
.field-hint a { color: var(--accent2); text-decoration: none; }
.field-hint a:hover { text-decoration: underline; }

.modal-actions { display: flex; gap: 0.75rem; margin-top: 1.5rem; }

.btn-primary {
  flex: 1;
  background: var(--accent);
  color: #000;
  border: none;
  border-radius: 8px;
  padding: 0.75rem;
  font-weight: 600;
  font-size: 0.85rem;
  cursor: pointer;
  transition: opacity 0.2s;
  font-family: 'DM Sans', sans-serif;
}
.btn-primary:hover { opacity: 0.88; }
.btn-primary:disabled { opacity: 0.4; cursor: not-allowed; }

.btn-ghost {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--muted2);
  border-radius: 8px;
  padding: 0.75rem 1.2rem;
  font-size: 0.82rem;
  cursor: pointer;
  transition: all 0.2s;
  font-family: 'DM Sans', sans-serif;
}
.btn-ghost:hover { border-color: var(--muted2); color: var(--text); }

.modal-error { font-size: 0.78rem; color: var(--accent3); margin-top: 0.75rem; font-family: var(--mono); display: none; }

/* â”€â”€ CHECKLIST â”€â”€ */
.checklist-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1.25rem;
  flex-wrap: wrap;
  gap: 0.75rem;
}

.page-title { font-family: 'Playfair Display', serif; font-size: 1.5rem; }
.page-title span { color: var(--accent); }

.streak-badge {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  background: var(--surface);
  border: 1px solid var(--border);
  padding: 0.45rem 1rem;
  border-radius: 8px;
  font-family: var(--mono);
  font-size: 0.78rem;
}
.streak-num { color: var(--accent); font-weight: 500; }

.daily-progress {
  display: flex;
  align-items: center;
  gap: 1.5rem;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 1.25rem 1.5rem;
  margin-bottom: 1.25rem;
  flex-wrap: wrap;
}

.ring-wrap { position: relative; width: 80px; height: 80px; flex-shrink: 0; }
.ring-wrap svg { transform: rotate(-90deg); }
.ring-bg { fill: none; stroke: var(--border2); stroke-width: 7; }
.ring-fill {
  fill: none;
  stroke: var(--accent);
  stroke-width: 7;
  stroke-linecap: round;
  stroke-dasharray: 220;
  stroke-dashoffset: 220;
  transition: stroke-dashoffset 0.6s cubic-bezier(.4,0,.2,1);
}
.ring-label {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%,-50%);
  font-family: var(--mono);
  font-size: 0.9rem;
  font-weight: 500;
  color: var(--accent);
}

.progress-info { flex: 1; min-width: 160px; }
.progress-info h2 { font-family: 'Playfair Display', serif; font-size: 1rem; margin-bottom: 0.25rem; }
.progress-info p { font-size: 0.8rem; color: var(--muted2); margin-bottom: 0.7rem; }

.mini-cats { display: flex; gap: 1rem; flex-wrap: wrap; }
.mini-cat { font-size: 0.72rem; font-family: var(--mono); color: var(--muted2); }
.mini-cat span { color: var(--text); font-weight: 500; }

/* Sections */
.sections { display: flex; flex-direction: column; gap: 0.7rem; }

.section {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  overflow: hidden;
  transition: border-color 0.3s;
}
.section.complete { border-color: rgba(76,175,125,0.4); }

.section-header {
  display: flex;
  align-items: center;
  gap: 0.7rem;
  padding: 0.8rem 1.1rem;
  cursor: pointer;
  user-select: none;
}
.section-header:hover { background: rgba(255,255,255,0.02); }

.sec-icon { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 8px; background: rgba(255,255,255,0.04); font-size: 0.95rem; flex-shrink: 0; }
.sec-info { flex: 1; }
.sec-name { font-size: 0.87rem; font-weight: 600; }
.sec-time { font-size: 0.7rem; color: var(--muted); font-family: var(--mono); }

.sec-progress { display: flex; align-items: center; gap: 0.5rem; }
.sec-bar-wrap { width: 56px; height: 4px; background: var(--border2); border-radius: 100px; overflow: hidden; }
.sec-bar { height: 100%; border-radius: 100px; transition: width 0.4s; }
.sec-count { font-family: var(--mono); font-size: 0.7rem; color: var(--muted2); min-width: 28px; text-align: right; }
.chevron { color: var(--muted); font-size: 0.65rem; transition: transform 0.2s; }
.section.collapsed .chevron { transform: rotate(-90deg); }

.section-items { padding: 0.25rem 0 0.5rem; border-top: 1px solid var(--border); }
.section.collapsed .section-items { display: none; }

.sublabel { font-size: 0.66rem; letter-spacing: 2px; text-transform: uppercase; color: var(--muted); padding: 0.45rem 1.1rem 0.15rem; font-family: var(--mono); }
.divider { border: none; border-top: 1px solid var(--border); margin: 0.3rem 1.1rem; }

.item { display: flex; align-items: flex-start; gap: 0.75rem; padding: 0.5rem 1.1rem; cursor: pointer; transition: background 0.12s; }
.item:hover { background: rgba(255,255,255,0.025); }
.item.checked { opacity: 0.35; }
.item.checked .item-text { text-decoration: line-through; color: var(--muted); }

.cb { width: 16px; height: 16px; border: 1.5px solid var(--border2); border-radius: 4px; flex-shrink: 0; margin-top: 2px; display: flex; align-items: center; justify-content: center; transition: all 0.18s; }
.item.checked .cb { background: var(--green); border-color: var(--green); }
.cb svg { display: none; width: 9px; height: 9px; stroke: #fff; stroke-width: 2.5; fill: none; }
.item.checked .cb svg { display: block; }

.item-text { font-size: 0.83rem; line-height: 1.5; }
.item-note { font-size: 0.71rem; color: var(--muted); margin-top: 1px; }

.bottom-bar { display: flex; align-items: center; justify-content: space-between; margin-top: 1.25rem; padding-top: 1.25rem; border-top: 1px solid var(--border); flex-wrap: wrap; gap: 0.75rem; }

.save-status { font-family: var(--mono); font-size: 0.72rem; color: var(--muted); display: flex; align-items: center; gap: 0.4rem; }

.reset-btn { background: transparent; border: 1px solid var(--border); color: var(--muted2); font-family: var(--mono); font-size: 0.72rem; padding: 0.45rem 1rem; border-radius: 6px; cursor: pointer; letter-spacing: 1px; transition: all 0.2s; }
.reset-btn:hover { border-color: var(--accent3); color: var(--accent3); }

/* â”€â”€ DASHBOARD â”€â”€ */
.dash-grid { display: grid; grid-template-columns: repeat(4,1fr); gap: 1rem; margin-bottom: 1.25rem; }

.stat-card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 1.1rem 1.3rem; }
.stat-label { font-family: var(--mono); font-size: 0.66rem; color: var(--muted); letter-spacing: 1.5px; text-transform: uppercase; margin-bottom: 0.4rem; }
.stat-value { font-family: 'Playfair Display', serif; font-size: 1.9rem; line-height: 1; }
.stat-value.y { color: var(--accent); }
.stat-value.g { color: var(--green); }
.stat-value.b { color: var(--accent2); }
.stat-sub { font-size: 0.72rem; color: var(--muted2); margin-top: 0.3rem; }

.chart-card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 1.3rem; margin-bottom: 1rem; }
.chart-title { font-family: var(--mono); font-size: 0.68rem; letter-spacing: 1.5px; text-transform: uppercase; color: var(--muted); margin-bottom: 1.1rem; display: flex; align-items: center; gap: 0.5rem; }
.chart-title::before { content: ''; display: inline-block; width: 6px; height: 6px; border-radius: 50%; background: var(--accent); }

.dash-two { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem; }

/* bar chart */
.bar-chart { display: flex; align-items: flex-end; gap: 3px; height: 110px; position: relative; }
.bar-chart::before { content: ''; position: absolute; left:0;right:0;top:0;bottom:0; background: repeating-linear-gradient(transparent,transparent calc(25% - 1px),var(--border) calc(25% - 1px),var(--border) 25%); pointer-events: none; }

.bar-col { flex:1; display: flex; flex-direction: column; align-items: center; gap: 3px; height: 100%; justify-content: flex-end; }
.bar { width: 100%; border-radius: 3px 3px 0 0; min-height: 2px; cursor: pointer; position: relative; transition: opacity 0.15s; }
.bar:hover { opacity: 0.8; }
.bar:hover::after { content: attr(data-tip); position: absolute; bottom: calc(100% + 5px); left: 50%; transform: translateX(-50%); background: var(--surface); border: 1px solid var(--border2); color: var(--text); font-size: 0.68rem; font-family: var(--mono); padding: 3px 7px; border-radius: 4px; white-space: nowrap; z-index: 10; pointer-events: none; }
.bar-lbl { font-family: var(--mono); font-size: 0.58rem; color: var(--muted); text-align: center; width: 100%; }

/* categories */
.cat-breakdown { display: flex; flex-direction: column; gap: 0.85rem; }
.cat-row { display: flex; align-items: center; gap: 0.75rem; }
.cat-name { font-size: 0.8rem; width: 90px; flex-shrink: 0; }
.cat-bar-wrap { flex:1; height: 5px; background: var(--border2); border-radius: 100px; overflow: hidden; }
.cat-bar { height: 100%; border-radius: 100px; transition: width 0.6s cubic-bezier(.4,0,.2,1); }
.cat-pct { font-family: var(--mono); font-size: 0.72rem; color: var(--muted2); width: 34px; text-align: right; }

/* missed */
.missed-list { display: flex; flex-direction: column; gap: 0.45rem; }
.missed-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.45rem 0.75rem; background: var(--surface); border-radius: 8px; border: 1px solid var(--border); }
.missed-name { font-size: 0.79rem; flex: 2; }
.missed-bar-wrap { flex:1; height: 3px; background: var(--border2); border-radius: 100px; overflow: hidden; }
.missed-bar { height: 100%; border-radius: 100px; background: var(--accent3); }
.missed-pct { font-family: var(--mono); font-size: 0.72rem; color: var(--accent3); width: 34px; text-align: right; }

/* heatmap */
.heatmap-grid { display: grid; grid-template-columns: repeat(30,1fr); gap: 3px; }
.heat-cell { aspect-ratio: 1; border-radius: 3px; cursor: pointer; position: relative; transition: transform 0.1s; }
.heat-cell:hover { transform: scale(1.4); z-index: 5; }
.heat-cell:hover::after { content: attr(data-tip); position: absolute; bottom: calc(100% + 4px); left: 50%; transform: translateX(-50%); background: var(--surface); border: 1px solid var(--border2); color: var(--text); font-size: 0.65rem; font-family: var(--mono); padding: 3px 6px; border-radius: 4px; white-space: nowrap; z-index: 10; pointer-events: none; }

.heatmap-legend { display: flex; align-items: center; gap: 0.4rem; margin-top: 0.6rem; font-size: 0.68rem; color: var(--muted); font-family: var(--mono); }
.legend-cell { width: 10px; height: 10px; border-radius: 2px; }

.empty-state { text-align: center; padding: 1.5rem; color: var(--muted); font-size: 0.82rem; font-family: var(--mono); }

/* note view */
.note-card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 1.3rem; margin-bottom: 1rem; }
.note-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.9rem; flex-wrap: wrap; gap: 0.5rem; }
.note-date { font-family: var(--mono); font-size: 0.8rem; color: var(--accent); }

.note-textarea {
  width: 100%;
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: 8px;
  color: var(--text);
  font-family: 'DM Sans', sans-serif;
  font-size: 0.85rem;
  padding: 0.9rem;
  resize: vertical;
  min-height: 120px;
  outline: none;
  transition: border-color 0.2s;
  line-height: 1.6;
}
.note-textarea:focus { border-color: var(--accent2); }
.note-textarea::placeholder { color: var(--muted); }

.note-save-btn {
  margin-top: 0.6rem;
  background: var(--accent2);
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 0.6rem 1.3rem;
  font-size: 0.82rem;
  font-weight: 600;
  cursor: pointer;
  font-family: 'DM Sans', sans-serif;
  transition: opacity 0.2s;
}
.note-save-btn:hover { opacity: 0.85; }

.past-notes { display: flex; flex-direction: column; gap: 0.7rem; }
.past-note { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 0.9rem 1rem; }
.past-note-date { font-family: var(--mono); font-size: 0.68rem; color: var(--muted); margin-bottom: 0.4rem; }
.past-note-text { font-size: 0.83rem; line-height: 1.6; color: var(--muted2); white-space: pre-wrap; }

@media (max-width: 680px) {
  .dash-grid { grid-template-columns: repeat(2,1fr); }
  .dash-two { grid-template-columns: 1fr; }
  .heatmap-grid { grid-template-columns: repeat(15,1fr); }
  nav { padding: 0.8rem 1rem; }
  .view { padding: 1rem; }
}
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="login-screen">
  <div class="login-box">
    <div class="login-logo">PY Â· HEALTH</div>
    <h1>Welcome <span>Back</span></h1>
    <p class="login-subtitle">Your personal health dashboard</p>
    <div class="login-fields">
      <div class="field">
        <label>Username</label>
        <input type="text" id="login-user" placeholder="Enter username" autocomplete="username" />
      </div>
      <div class="field">
        <label>Password</label>
        <input type="password" id="login-pass" placeholder="Enter password" autocomplete="current-password" />
      </div>
    </div>
    <div class="login-error" id="login-error">âœ— Incorrect username or password</div>
    <button class="login-btn" id="login-btn" onclick="doLogin()">Sign In</button>
  </div>
</div>

<!-- SETUP MODAL -->
<div class="modal-overlay" id="setup-modal">
  <div class="modal">
    <h2>Connect GitHub Storage</h2>
    <p>Your data will be saved privately to your GitHub repo. You only need to do this once. <a href="SETUP.md" target="_blank">See setup guide â†’</a></p>

    <div class="field">
      <label>Personal Access Token</label>
      <input type="password" id="cfg-token" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" />
      <div class="field-hint">
        Create one at <a href="https://github.com/settings/tokens/new" target="_blank">github.com/settings/tokens</a><br>
        Scopes needed: <strong>repo</strong> (full control of private repos).<br>
        This is stored only in your browser's localStorage.
      </div>
    </div>

    <div class="modal-error" id="modal-error"></div>
    <div class="modal-actions">
      <button class="btn-primary" id="setup-save-btn" onclick="saveConfig()">Connect & Save</button>
    </div>
  </div>
</div>

<!-- NAV -->
<nav>
  <div class="nav-logo">PY Â· HEALTH</div>
  <div class="nav-tabs">
    <button class="nav-tab active" onclick="switchView('checklist', this)">Today</button>
    <button class="nav-tab" onclick="switchView('dashboard', this)">Dashboard</button>
    <button class="nav-tab" onclick="switchView('notes', this)">Notes</button>
  </div>
  <div class="nav-right">
    <div class="sync-status">
      <div class="sync-dot" id="sync-dot"></div>
      <span id="sync-label" style="color:var(--muted)">not connected</span>
    </div>
    <button class="settings-btn" onclick="openSettings()">âš™ settings</button>
    <button class="logout-btn" onclick="doLogout()">â†© logout</button>
  </div>
</nav>

<!-- CHECKLIST VIEW -->
<div class="view active" id="view-checklist">
  <div class="checklist-top">
    <div class="page-title">Daily <span>Routine</span></div>
    <div style="display:flex;align-items:center;gap:0.75rem;flex-wrap:wrap;">
      <div class="date-picker-wrap">
        <button class="date-nav-btn" id="prev-day-btn" onclick="shiftDay(-1)" title="Previous day">â€¹</button>
        <input type="date" id="date-picker" onchange="onDateChange(this.value)" />
        <button class="date-nav-btn" id="next-day-btn" onclick="shiftDay(1)" title="Next day">â€º</button>
        <span class="today-tag" id="today-tag" style="display:none">TODAY</span>
      </div>
      <div class="streak-badge">ðŸ”¥ <span class="streak-num" id="streak-num">0</span> <span style="color:var(--muted2)">day streak</span></div>
    </div>
  </div>

  <div class="daily-progress">
    <div class="ring-wrap">
      <svg width="80" height="80" viewBox="0 0 80 80">
        <circle class="ring-bg" cx="40" cy="40" r="35"/>
        <circle class="ring-fill" id="ring-fill" cx="40" cy="40" r="35"/>
      </svg>
      <div class="ring-label" id="ring-pct">0%</div>
    </div>
    <div class="progress-info">
      <h2 id="progress-date-label">Today's Progress</h2>
      <p id="progress-sub">0 of 0 tasks completed</p>
      <div class="mini-cats" id="mini-cats"></div>
    </div>
  </div>

  <div class="sections" id="sections-container"></div>

  <div class="bottom-bar">
    <div class="save-status" id="save-status">
      <div class="sync-dot" id="save-dot"></div>
      <span id="save-label">ready</span>
    </div>
    <button class="reset-btn" onclick="resetToday()">â†º reset today</button>
  </div>
</div>

<!-- DASHBOARD VIEW -->
<div class="view" id="view-dashboard">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1.25rem;flex-wrap:wrap;gap:0.75rem;">
    <div class="page-title">Health <span>Insights</span></div>
    <div style="font-family:var(--mono);font-size:0.7rem;color:var(--muted)">Last 30 days</div>
  </div>
  <div class="dash-grid" id="stat-cards"></div>
  <div class="chart-card">
    <div class="chart-title">30-Day Completion Rate</div>
    <div class="bar-chart" id="completion-chart"></div>
    <div style="display:flex;justify-content:space-between;margin-top:0.4rem;">
      <div style="font-family:var(--mono);font-size:0.62rem;color:var(--muted)">30 days ago</div>
      <div style="font-family:var(--mono);font-size:0.62rem;color:var(--muted)">Today</div>
    </div>
  </div>
  <div class="dash-two">
    <div class="chart-card">
      <div class="chart-title">Category Breakdown</div>
      <div class="cat-breakdown" id="cat-breakdown"></div>
    </div>
    <div class="chart-card">
      <div class="chart-title">Most Missed Items</div>
      <div class="missed-list" id="missed-list"></div>
    </div>
  </div>
  <div class="chart-card">
    <div class="chart-title">Completion Heatmap â€” Last 30 Days</div>
    <div class="heatmap-grid" id="heatmap"></div>
    <div class="heatmap-legend">
      <span>Less</span>
      <div class="legend-cell" style="background:#1a2030"></div>
      <div class="legend-cell" style="background:#2a3a20"></div>
      <div class="legend-cell" style="background:#3d6030"></div>
      <div class="legend-cell" style="background:#4caf50"></div>
      <div class="legend-cell" style="background:#7ddc81"></div>
      <span>More</span>
    </div>
  </div>
</div>

<!-- NOTES VIEW -->
<div class="view" id="view-notes">
  <div style="margin-bottom:1.25rem;">
    <div class="page-title">Daily <span>Notes</span></div>
    <div style="font-size:0.8rem;color:var(--muted2);margin-top:0.3rem;">Log how you feel, what worked, what didn't.</div>
  </div>

  <div class="note-card">
    <div class="note-header">
      <div class="note-date" id="note-today-date"></div>
      <div style="font-family:var(--mono);font-size:0.7rem;color:var(--muted)">Today's note</div>
    </div>
    <textarea class="note-textarea" id="note-input" placeholder="How did today go? Energy levels, anything you noticed, how the routine felt..."></textarea>
    <br>
    <button class="note-save-btn" onclick="saveNote()">Save Note</button>
  </div>

  <div class="chart-title" style="margin-bottom:0.75rem;">Past Notes</div>
  <div class="past-notes" id="past-notes"></div>
</div>

<script>
// â”€â”€â”€ CONSTANTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SECTIONS = [
  { icon:"ðŸŒ…", title:"Wake Up", time:"9:00 AM", cat:"morning", items:[
    {text:"Wake up"},
    {text:"1 glass warm water"},
    {text:"Light stretch", note:"2â€“3 min"},
  ]},
  { icon:"ðŸ¥¤", title:"Shake & Supplements", time:"9:15â€“9:35 AM", cat:"morning", items:[
    {text:"High-calorie shake", note:"Banana, whole milk, almonds + cashews, peanut butter, dates + jaggery, roasted chana powder, 1 scoop whey protein, creatine 5g"},
    {divider:true},
    {label:"Morning Supplements"},
    {text:"Multivitamin", note:"1 capsule"},
    {text:"Biotin 5000 mcg"},
  ]},
  { icon:"ðŸ³", title:"Breakfast", time:"11:45 AM", cat:"morning", items:[
    {text:"4 whole eggs OR paneer OR 2 rotis or bread"},
  ]},
  { icon:"ðŸš¿", title:"Shower & Grooming", time:"10:30â€“11:00 AM", cat:"midday", items:[
    {text:"Shampoo"},
    {text:"Face wash"},
    {divider:true},
    {label:"Skincare"},
    {text:"AXIS-Y Dark Spot Serum"},
    {text:"COSRX Oil-Free Moisturizer"},
    {text:"Sunscreen SPF 50", note:"Mandatory"},
    {divider:true},
    {label:"Hair & Beard"},
    {text:"Rogaine 5% Minoxidil", note:"On scalp"},
    {text:"Beard oil", note:"Bossman â€“ Naked"},
  ]},
  { icon:"ðŸ½ï¸", title:"Lunch", time:"2:00â€“3:00 PM", cat:"midday", items:[
    {text:"Chicken / Fish / Prawns / Goat & Rice / Dal / Veggies / 1 tsp ghee"},
    {divider:true},
    {label:"After Food Supplements"},
    {text:"Vitamin D3 + K2"},
    {text:"Zinc 22mg", note:"Always after food"},
  ]},
  { icon:"â˜•", title:"Light Snack", time:"5:30 PM", cat:"midday", items:[
    {text:"Banana + peanuts OR 2 boiled eggs OR Curd + fruit"},
  ]},
  { icon:"ðŸŒ™", title:"Dinner", time:"9:45 PM", cat:"night", items:[
    {text:"Chicken / Fish / 3 eggs & Roti or rice & Veggies"},
  ]},
  { icon:"ðŸ¥›", title:"Night Protein", time:"10:30 PM", cat:"night", items:[
    {text:"Greek yogurt"},
  ]},
  { icon:"ðŸ’Š", title:"Night Supplement", time:"11:30 PM", cat:"night", items:[
    {text:"Magnesium glycinate 200â€“300mg"},
  ]},
  { icon:"ðŸ˜´", title:"Sleep", time:"12:00â€“1:00 AM", cat:"night", items:[
    {text:"Sleep"},
  ]},
];

const CAT_COLORS = { morning:'#f5c842', midday:'#5b8dee', night:'#9b6bda' };
const CAT_LABELS = { morning:'ðŸŒ… Morning', midday:'â˜€ï¸ Midday', night:'ðŸŒ™ Night' };
const HEAT_COLORS = ['#1a2030','#2a3a20','#3d6030','#4caf50','#7ddc81'];

// â”€â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getConfig() {
  return {
    user: 'pawanyandapalli7',
    repo: 'health-tracker',
    token: localStorage.getItem('gh_token') || '',
  };
}

function isConfigured() {
  return !!localStorage.getItem('gh_token');
}

function saveConfig() {
  const token = document.getElementById('cfg-token').value.trim();
  const errEl = document.getElementById('modal-error');
  errEl.style.display = 'none';

  if (!token) { errEl.textContent = 'Please enter your Personal Access Token.'; errEl.style.display = 'block'; return; }

  const btn = document.getElementById('setup-save-btn');
  btn.disabled = true;
  btn.textContent = 'Connecting...';

  const { user, repo } = getConfig();
  fetch(`https://api.github.com/repos/${user}/${repo}`, {
    headers: { Authorization: `token ${token}`, Accept: 'application/vnd.github.v3+json' }
  }).then(r => {
    if (!r.ok) throw new Error(`Token invalid or repo not found (${r.status})`);
    localStorage.setItem('gh_token', token);
    document.getElementById('setup-modal').classList.add('hidden');
    initApp();
  }).catch(e => {
    errEl.textContent = 'âœ— ' + e.message;
    errEl.style.display = 'block';
    btn.disabled = false;
    btn.textContent = 'Connect & Save';
  });
}

function openSettings() {
  const c = getConfig();
  document.getElementById('cfg-token').value = c.token;
  document.getElementById('setup-modal').classList.remove('hidden');
}

// â”€â”€â”€ GITHUB API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DATA_FILE = 'data.json';
let ghFileSha = null;

async function ghGet() {
  const { user, repo, token } = getConfig();
  setSyncStatus('syncing', 'loading...');
  try {
    const r = await fetch(`https://api.github.com/repos/${user}/${repo}/contents/${DATA_FILE}`, {
      headers: { Authorization: `token ${token}`, Accept: 'application/vnd.github.v3+json' }
    });
    if (r.status === 404) {
      ghFileSha = null;
      setSyncStatus('synced', 'connected');
      return {};
    }
    if (!r.ok) throw new Error(`GitHub error ${r.status}`);
    const json = await r.json();
    ghFileSha = json.sha;
    const data = JSON.parse(atob(json.content.replace(/\n/g,'')));
    setSyncStatus('synced', 'synced');
    return data;
  } catch(e) {
    setSyncStatus('error', 'sync error');
    console.error(e);
    return null;
  }
}

async function ghSave(data) {
  const { user, repo, token } = getConfig();
  setSyncDot('save-dot', 'syncing');
  document.getElementById('save-label').textContent = 'saving...';
  try {
    const body = { message: `health: update ${todayKey()}`, content: btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2)))) };
    if (ghFileSha) body.sha = ghFileSha;
    const r = await fetch(`https://api.github.com/repos/${user}/${repo}/contents/${DATA_FILE}`, {
      method: 'PUT',
      headers: { Authorization: `token ${token}`, Accept: 'application/vnd.github.v3+json', 'Content-Type': 'application/json' },
      body: JSON.stringify(body)
    });
    if (!r.ok) throw new Error(`Save failed ${r.status}`);
    const json = await r.json();
    ghFileSha = json.content.sha;
    setSyncDot('save-dot', 'synced');
    document.getElementById('save-label').textContent = 'saved to GitHub âœ“';
    setTimeout(() => { setSyncDot('save-dot',''); document.getElementById('save-label').textContent = 'ready'; }, 2500);
  } catch(e) {
    setSyncDot('save-dot', 'error');
    document.getElementById('save-label').textContent = 'save failed â€” retry';
    console.error(e);
  }
}

// â”€â”€â”€ LOCAL CACHE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let localData = {};
let activeKey = new Date().toISOString().split('T')[0]; // currently viewed date

function todayKey() { return new Date().toISOString().split('T')[0]; }
function isToday() { return activeKey === todayKey(); }

function getActiveData() { return localData[activeKey] || { checks: {}, note: '' }; }

function setActiveData(d) {
  localData[activeKey] = d;
  debouncedSave();
}

// â”€â”€â”€ DATE PICKER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initDatePicker() {
  const picker = document.getElementById('date-picker');
  picker.value = activeKey;
  picker.max = todayKey(); // can't go into the future
  updateDateUI();
}

function onDateChange(val) {
  if (!val) return;
  activeKey = val;
  updateDateUI();
  renderChecklist();
}

function shiftDay(delta) {
  const d = new Date(activeKey + 'T12:00:00');
  d.setDate(d.getDate() + delta);
  const newKey = d.toISOString().split('T')[0];
  if (newKey > todayKey()) return;
  activeKey = newKey;
  document.getElementById('date-picker').value = activeKey;
  updateDateUI();
  renderChecklist();
}

function updateDateUI() {
  const today = isToday();
  document.getElementById('today-tag').style.display = today ? 'inline' : 'none';
  document.getElementById('next-day-btn').disabled = isToday();
  const d = new Date(activeKey + 'T12:00:00');
  const label = today ? "Today's Progress" : d.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });
  document.getElementById('progress-date-label').textContent = label;
}

let saveTimer = null;
function debouncedSave() {
  clearTimeout(saveTimer);
  saveTimer = setTimeout(() => ghSave(localData), 1200);
}

// â”€â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getCheckableItems() {
  const items = [];
  SECTIONS.forEach((s, si) => {
    s.items.forEach((item, ii) => {
      if (item.text) items.push({ si, ii, text: item.text, cat: s.cat, section: s.title });
    });
  });
  return items;
}

function calcStats(dayData) {
  const all = getCheckableItems();
  const done = all.filter(i => dayData.checks && dayData.checks[`${i.si}-${i.ii}`]).length;
  return { total: all.length, done, pct: all.length ? Math.round(done / all.length * 100) : 0 };
}

function calcStreak() {
  let streak = 0;
  const today = new Date();
  for (let i = 0; i < 365; i++) {
    const d = new Date(today); d.setDate(d.getDate() - i);
    const key = d.toISOString().split('T')[0];
    const day = localData[key];
    if (!day) { if (i === 0) continue; break; }
    if (calcStats(day).pct >= 80) streak++;
    else if (i > 0) break;
  }
  return streak;
}

function calcLongest() {
  const keys = Object.keys(localData).sort();
  let longest = 0, cur = 0;
  keys.forEach(k => {
    if (calcStats(localData[k]).pct >= 80) { cur++; longest = Math.max(longest, cur); }
    else cur = 0;
  });
  return longest;
}

function setSyncStatus(state, label) {
  setSyncDot('sync-dot', state);
  document.getElementById('sync-label').textContent = label;
  document.getElementById('sync-label').style.color = state === 'synced' ? 'var(--green)' : state === 'error' ? 'var(--accent3)' : 'var(--muted2)';
}

function setSyncDot(id, state) {
  const el = document.getElementById(id);
  if (!el) return;
  el.className = 'sync-dot' + (state ? ' ' + state : '');
}

// â”€â”€â”€ CHECKLIST RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderChecklist() {
  const dayData = getActiveData();
  const container = document.getElementById('sections-container');
  container.innerHTML = '';

  SECTIONS.forEach((section, si) => {
    const checkable = section.items.filter(i => i.text);
    const done = checkable.filter(item => {
      const ii = section.items.indexOf(item);
      return dayData.checks && dayData.checks[`${si}-${ii}`];
    }).length;
    const pct = checkable.length ? Math.round(done / checkable.length * 100) : 0;
    const isComplete = done === checkable.length && checkable.length > 0;

    const sEl = document.createElement('div');
    sEl.className = 'section' + (isComplete ? ' complete' : '');

    const hdr = document.createElement('div');
    hdr.className = 'section-header';
    hdr.innerHTML = `
      <div class="sec-icon">${section.icon}</div>
      <div class="sec-info">
        <div class="sec-name">${section.title}</div>
        <div class="sec-time">${section.time}</div>
      </div>
      <div class="sec-progress">
        <div class="sec-bar-wrap"><div class="sec-bar" id="sb-${si}" style="width:${pct}%;background:${CAT_COLORS[section.cat]}"></div></div>
        <div class="sec-count" id="sc-${si}">${checkable.length ? `${done}/${checkable.length}` : ''}</div>
      </div>
      <div class="chevron">â–¾</div>
    `;
    hdr.addEventListener('click', () => sEl.classList.toggle('collapsed'));

    const itemsEl = document.createElement('div');
    itemsEl.className = 'section-items';

    section.items.forEach((item, ii) => {
      if (item.label) {
        const l = document.createElement('div'); l.className = 'sublabel'; l.textContent = item.label; itemsEl.appendChild(l); return;
      }
      if (item.divider) {
        const d = document.createElement('hr'); d.className = 'divider'; itemsEl.appendChild(d); return;
      }
      const key = `${si}-${ii}`;
      const checked = !!(dayData.checks && dayData.checks[key]);
      const div = document.createElement('div');
      div.className = 'item' + (checked ? ' checked' : '');
      div.innerHTML = `<div class="cb"><svg viewBox="0 0 12 9"><polyline points="1,4.5 4.5,8 11,1"/></svg></div><div><div class="item-text">${item.text}</div>${item.note ? `<div class="item-note">${item.note}</div>` : ''}</div>`;
      div.addEventListener('click', () => {
        const d = getActiveData();
        if (!d.checks) d.checks = {};
        d.checks[key] = !d.checks[key];
        setActiveData(d);
        div.classList.toggle('checked', !!d.checks[key]);
        updateRing();
        updateSecBar(si, section);
      });
      itemsEl.appendChild(div);
    });

    sEl.appendChild(hdr);
    sEl.appendChild(itemsEl);
    container.appendChild(sEl);
  });

  updateRing();
  initDatePicker();
  document.getElementById('streak-num').textContent = calcStreak();
}

function updateRing() {
  const dayData = getActiveData();
  const stats = calcStats(dayData);
  const circ = 220;
  document.getElementById('ring-fill').style.strokeDashoffset = circ - (circ * stats.pct / 100);
  document.getElementById('ring-pct').textContent = stats.pct + '%';
  document.getElementById('progress-sub').textContent = `${stats.done} of ${stats.total} tasks completed`;

  const el = document.getElementById('mini-cats');
  el.innerHTML = '';
  const allItems = getCheckableItems();
  ['morning','midday','night'].forEach(cat => {
    const catItems = allItems.filter(i => i.cat === cat);
    const catDone = catItems.filter(i => dayData.checks && dayData.checks[`${i.si}-${i.ii}`]).length;
    const d = document.createElement('div');
    d.className = 'mini-cat';
    d.style.color = CAT_COLORS[cat];
    d.innerHTML = `<span style="color:var(--text)">${catDone}/${catItems.length}</span> ${cat}`;
    el.appendChild(d);
  });
}

function updateSecBar(si, section) {
  const dayData = getActiveData();
  const checkable = section.items.filter(i => i.text);
  const done = checkable.filter(item => {
    const ii = section.items.indexOf(item);
    return dayData.checks && dayData.checks[`${si}-${ii}`];
  }).length;
  const pct = checkable.length ? Math.round(done / checkable.length * 100) : 0;
  const bar = document.getElementById(`sb-${si}`);
  const cnt = document.getElementById(`sc-${si}`);
  if (bar) bar.style.width = pct + '%';
  if (cnt) cnt.textContent = `${done}/${checkable.length}`;
}

function resetToday() {
  const label = isToday() ? 'today' : new Date(activeKey + 'T12:00:00').toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
  if (!confirm(`Reset all checkboxes for ${label}?`)) return;
  const d = getActiveData();
  d.checks = {};
  setActiveData(d);
  renderChecklist();
}

// â”€â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderDashboard() {
  const allKeys = Object.keys(localData).sort();
  const allItems = getCheckableItems();
  const daysLogged = allKeys.length;
  const streak = calcStreak();
  const longest = calcLongest();
  const todayStats = calcStats(localData[todayKey()] || { checks: {} });
  const avgPct = daysLogged ? Math.round(allKeys.reduce((s, k) => s + calcStats(localData[k]).pct, 0) / daysLogged) : 0;

  // Stat cards
  document.getElementById('stat-cards').innerHTML = [
    { label:'Today', value:todayStats.pct+'%', sub:`${todayStats.done}/${todayStats.total} tasks`, cls:'y' },
    { label:'Current Streak', value:streak, sub:'days â‰¥80% complete', cls:'g' },
    { label:'Longest Streak', value:longest, sub:'days', cls:'b' },
    { label:'Avg Completion', value:avgPct+'%', sub:`over ${daysLogged} days`, cls:'' },
  ].map(s => `<div class="stat-card"><div class="stat-label">${s.label}</div><div class="stat-value ${s.cls}">${s.value}</div><div class="stat-sub">${s.sub}</div></div>`).join('');

  // 30-day bar chart
  const chartEl = document.getElementById('completion-chart');
  chartEl.innerHTML = '';
  for (let i = 29; i >= 0; i--) {
    const d = new Date(); d.setDate(d.getDate() - i);
    const k = d.toISOString().split('T')[0];
    const day = localData[k];
    const pct = day ? calcStats(day).pct : null;
    const label = d.toLocaleDateString('en-US',{month:'short',day:'numeric'});
    const color = pct === null ? 'var(--border2)' : pct >= 80 ? 'var(--green)' : pct >= 50 ? 'var(--accent)' : 'var(--accent3)';
    const col = document.createElement('div');
    col.className = 'bar-col';
    col.innerHTML = `<div class="bar" style="height:${pct??0}%;background:${color}" data-tip="${label}: ${pct!==null?pct+'%':'no data'}"></div>${(29-i)%7===0?`<div class="bar-lbl">${label}</div>`:'<div class="bar-lbl"></div>'}`;
    chartEl.appendChild(col);
  }

  // Category breakdown
  const catEl = document.getElementById('cat-breakdown');
  if (daysLogged === 0) { catEl.innerHTML = '<div class="empty-state">No data yet.</div>'; }
  else {
    catEl.innerHTML = '';
    ['morning','midday','night'].forEach(cat => {
      const catItems = allItems.filter(i => i.cat === cat);
      const total = catItems.length * daysLogged;
      let done = 0;
      allKeys.forEach(k => catItems.forEach(i => { if (localData[k].checks && localData[k].checks[`${i.si}-${i.ii}`]) done++; }));
      const pct = total ? Math.round(done / total * 100) : 0;
      const div = document.createElement('div');
      div.className = 'cat-row';
      div.innerHTML = `<div class="cat-name" style="color:${CAT_COLORS[cat]}">${CAT_LABELS[cat]}</div><div class="cat-bar-wrap"><div class="cat-bar" style="width:${pct}%;background:${CAT_COLORS[cat]}"></div></div><div class="cat-pct">${pct}%</div>`;
      catEl.appendChild(div);
    });
  }

  // Missed items
  const missEl = document.getElementById('missed-list');
  if (daysLogged === 0) { missEl.innerHTML = '<div class="empty-state">No data yet.</div>'; }
  else {
    missEl.innerHTML = '';
    const rates = allItems.map(item => {
      let missed = 0;
      allKeys.forEach(k => { if (!(localData[k].checks && localData[k].checks[`${item.si}-${item.ii}`])) missed++; });
      return { text: item.text, rate: Math.round(missed / daysLogged * 100) };
    });
    rates.sort((a,b) => b.rate - a.rate).slice(0, 6).forEach(item => {
      const div = document.createElement('div');
      div.className = 'missed-item';
      div.innerHTML = `<div class="missed-name">${item.text}</div><div class="missed-bar-wrap"><div class="missed-bar" style="width:${item.rate}%"></div></div><div class="missed-pct">${item.rate}%</div>`;
      missEl.appendChild(div);
    });
  }

  // Heatmap
  const heatEl = document.getElementById('heatmap');
  heatEl.innerHTML = '';
  for (let i = 29; i >= 0; i--) {
    const d = new Date(); d.setDate(d.getDate() - i);
    const k = d.toISOString().split('T')[0];
    const day = localData[k];
    const pct = day ? calcStats(day).pct : null;
    let ci = 0;
    if (pct !== null) ci = pct >= 90 ? 4 : pct >= 70 ? 3 : pct >= 50 ? 2 : pct > 0 ? 1 : 0;
    const cell = document.createElement('div');
    cell.className = 'heat-cell';
    cell.style.background = HEAT_COLORS[ci];
    cell.dataset.tip = `${d.toLocaleDateString('en-US',{month:'short',day:'numeric'})}: ${pct!==null?pct+'%':'no data'}`;
    heatEl.appendChild(cell);
  }
}

// â”€â”€â”€ NOTES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderNotes() {
  const activeDate = new Date(activeKey + 'T12:00:00');
  const isActiveToday = isToday();
  document.getElementById('note-today-date').textContent = isActiveToday
    ? new Date().toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric',year:'numeric'})
    : activeDate.toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric',year:'numeric'});
  const dayData = getActiveData();
  document.getElementById('note-input').value = dayData.note || '';

  const pastEl = document.getElementById('past-notes');
  pastEl.innerHTML = '';
  const keys = Object.keys(localData).sort().reverse();
  const withNotes = keys.filter(k => localData[k].note && localData[k].note.trim());
  if (withNotes.length === 0) {
    pastEl.innerHTML = '<div class="empty-state">No notes yet. Write your first one above.</div>';
    return;
  }
  withNotes.forEach(k => {
    const d = new Date(k);
    const div = document.createElement('div');
    div.className = 'past-note';
    div.innerHTML = `<div class="past-note-date">${d.toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric',year:'numeric'})}</div><div class="past-note-text">${localData[k].note}</div>`;
    pastEl.appendChild(div);
  });
}

function saveNote() {
  const text = document.getElementById('note-input').value;
  const d = getActiveData();
  d.note = text;
  setActiveData(d);
  renderNotes();
}

// â”€â”€â”€ NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchView(view, btn) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById(`view-${view}`).classList.add('active');
  if (btn) btn.classList.add('active');
  if (view === 'dashboard') renderDashboard();
  if (view === 'notes') renderNotes();
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function initApp() {
  setSyncStatus('syncing', 'loading...');
  const data = await ghGet();
  if (data !== null) {
    localData = data;
  } else {
    localData = {};
  }
  renderChecklist();
  // Set nav date
  document.title = `Health â€” ${new Date().toLocaleDateString('en-US',{month:'short',day:'numeric'})}`;
}

// â”€â”€â”€ AUTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// âš ï¸ Change these credentials to your own!
const AUTH_USER = 'pawan';
const AUTH_PASS = 'health2026';

function isLoggedIn() {
  return sessionStorage.getItem('ht_auth') === 'true';
}

function doLogin() {
  const user = document.getElementById('login-user').value.trim();
  const pass = document.getElementById('login-pass').value;
  const errEl = document.getElementById('login-error');
  const btn = document.getElementById('login-btn');

  if (user === AUTH_USER && pass === AUTH_PASS) {
    sessionStorage.setItem('ht_auth', 'true');
    document.getElementById('login-screen').classList.add('hidden');
    errEl.classList.remove('visible');
    bootApp();
  } else {
    errEl.classList.add('visible');
    btn.classList.remove('shake');
    void btn.offsetWidth; // reflow to retrigger animation
    btn.classList.add('shake');
    document.getElementById('login-pass').value = '';
    document.getElementById('login-pass').focus();
  }
}

function doLogout() {
  sessionStorage.removeItem('ht_auth');
  location.reload();
}

// Allow Enter key on login fields
document.getElementById('login-user').addEventListener('keydown', e => { if (e.key === 'Enter') document.getElementById('login-pass').focus(); });
document.getElementById('login-pass').addEventListener('keydown', e => { if (e.key === 'Enter') doLogin(); });

function bootApp() {
  if (isConfigured()) {
    document.getElementById('setup-modal').classList.add('hidden');
    initApp();
  } else {
    document.getElementById('setup-modal').classList.remove('hidden');
  }
}

// â”€â”€â”€ BOOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if (isLoggedIn()) {
  document.getElementById('login-screen').classList.add('hidden');
  bootApp();
}
</script>
</body>
</html>
